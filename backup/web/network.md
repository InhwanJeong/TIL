인터넷/네트워크 관련 지식
========================

## 컴퓨터 네트워크
    
## TCP/IP 모델 및 OSI 표준 모델
```
https://namu.wiki/w/%ED%8C%8C%EC%9D%BC:TCP%20IP.jpg
```
#### OSI 7계층
OSI 7계층 | 내용    
--- |  ---    
1.물리 계층 | 시스템을 연결하기 위한 전기/물리적 규격 : 얼만큼의 전압, 전선 등   
2.데이터 링크 계층 | 시스템 간의 신뢰성 있는 전송을 보장하기 위한 계층, CRC 기반의 오류제어와 흐름제어를 위한 규격을 제공(Frame)    
3.네트워크 계층 | 네트워크 계층은 경로를 찾기위한 규격을 제공 (Dategram)   
4.전송 계층 | 컴퓨터와 컴퓨터가 신뢰성 있는 데이터 전송을 보장하기 위한 여러 규격을 제공(Segment)   
5.세션 계층 | 소프트웨어의 통신을 관리하기 위한 규격을 제공(TCP/IP)
6.표현 계층 | 어떤 데이터를 인터넷으로 전송할 때 데이터는 다루기 좋은 형태로 인코딩되거나 암호화되는데 이에 대한 규격을 제공.   
7.응용 계층 | 데이터를 해석하고 표시하기위한 규격을 제공(HTTP, FTP)    
    
#### TCP/IP 4계층
TCP/IP 4계층 | 내용    
--- |  ---    
1.물리 계층 | OSI 물리계층과 동일(이더넷, 프레임 릴레이, 토큰 프레임, ATM)   
2.인터넷 계층 | 네트워크계층과 데이터링크 계층에 포함( ICMP, IP, ARP, RARP)   
3.전송 계층 | 세션계층, 전송계층을 포함 (TCP, UDP)    
4.응용 계층 | 표현계층, 응용계층을 포함 (HTTP, FTP, SM P, DNS, POP3, SNMP)     
    
@모든 인터넷 통신은 반드시 TCP/IP 4계층을 거쳐야한다.

#### WWW 서비스 방법
통신방법
---|
(클라이언트) 브라우저 -> TCP -> IP -> 이더넷 ->   
(인터넷) 라우터-> TCP/IP 패킷 -> 라우터 ->   
(서버) 이더넷 -> IP -> TCP -> 웹서버    
    
- 클라이언트에서 요청시 웹서버까지의 이동방향이다.     
- 마찬가지로 웹서버에서 응답시 반대방향으로 가면된다.   
    
@웹서핑은 검색엔진과 하이퍼링크로 이루어진다.

#### 캡슐화    
http://www.joinc.co.kr/index.html 이란 페이지를 요청시    
-> 주소가 www.joinc.co.kr이라는 컴퓨터에 index.html 파일을 요청한다는 뜻이다.    
이때, 데이터를 보낼때 4계층을 거치게 되는데   

데이터 | 계층
---|---
유저데이터            |                   4층    
데이터 + TCP 헤더        |                3층    
데이터 + TCP 헤더 + IP 헤더     |          2층    
데이터 + TCP 헤더 + IP 헤더 + 이더넷 헤더  | 1층    

마치 포장하듯 각 계층의 정보로 감싸지고 인터넷으로 가게 되는데 이를 캡슐화라고 한다.

#### 역다중화
우편물이 도착하면 캡슐화의 반대과정을 거친다

데이터 | 계층
---|---
데이터 + TCP 헤더 + IP 헤더 + 이더넷 헤더  | 1층 
데이터 + TCP 헤더 + IP 헤더     |          2층
데이터 + TCP 헤더        |                3층  
유저데이터            |                   4층    
      
즉, 서버가 위 과정과 같이 데이터를 받게되고   
웹서버는 또다시 위 과정을 역진행하여 클라이언트로 전송하게된다.   
  

#### 인터넷   
- 다른 매채들과 달리 양방향성이라는 특징을 가진다.(송수신)   
- 인터넷은 노드와 링크로 구성되어있다(그래프형식)   
- 데이터 통신을 할 때, 정보를 패킷에 담는다.    
- 패킷 데이터 통신은 데이터를 통으로 보내지않고 분할해서 보낸 후 다시 조립한다.     
- 네트워크 프로그램 개발을 위해서 제공하는 함수의 묶음을 소켓 API라고 한다.    
    
@네트워크 추상그림   
패킷제어, 오류검사, 패킷 재요청, 연결요청, 연결종료    
->    
TCP,IP,PORT, 캡슐화, 역다중화, UDP,ICMP, IPV4,IPV6, 이더넷 카드, 라우터    
->    
네트워크 -> 소켓함수 -> 개발자   
    
#### IP(Internet Protocol)
- IP는 인터넷 네비게이션이다.   
- 아이덴티티 : 자신만이 가지는 유일한 특징    
    
@라우터(경로배정기, 우체국 역할): 패킷을 어디로 보낼지 결정     
    
    
#### TCP(Transmission Control Protocol)    :  전송계층 SegMent   
- 다른 컴퓨터와 데이터 통신을 하기위한 규약   
- 동일계층으로 UDP가 존재한다.    
- 패킷교환 방식-> 데이터가 유실되거나 늦고 신뢰성이 떨어짐   -> TCP 등장     
    
## 네트워크 프로그램 환경구축

#### 운영체제
- 리눅스 또는 윈도우를 기반으로 연습   

#### 컴파일러
- GPL 라이센스를 따르는 컴파일러인 gcc를 사용   
- 버전확인 : ~$ gcc --version   
- 다운로드 : ~$ sudo apt-get install gcc    
@ GPL(Gerneral Public License)은 자유,공유,공개를 기반으로 한다.    

#### 에디터 선택
- Vi와 emacs라는 에디터를 사용   

#### virtualbox
- 윈도우에서 가상환경을 구축하여 리눅스를 사용할 수 있다.   
```
http://www.Virtualbox.org
```

## 소켓 프로그래밍

#### 소켓이란?
- 소켓 : 네트워크 프로그램 개발 계층 : TCP/IP 계층에서 응용계층 바로밑에 위치한다.    
- 버클리 소켓(BSD 소켓) : 네트워크 프로그램 개발을 위한 라이브러리와 API(Application Programming Interface) 제공.    
- 네트워크 프로그래밍 도구중 소켓뿐만 아니라 TLI, RPC/XDR 등이 있다.   
- 거의 모든 운영체제에서 BSD소켓을 사용
```
컴퓨터(파이어 폭스) <-> 소켓 <->  인터넷  <-> 소켓 <-> 컴퓨터(아파치)
```

#### 서버/클라이언트 모델

클라이언트 -> 요청 -> 서버   
클라이언트 <- 응답 -< 서버   

- 서버는 모든 정보를 처리하기 때문에 프로그램이 지나치게 복잡하고 고성능이 필요
- 해커의 공격에 데이터 분실과 파손에 취약한 단점을 가지고있다.    

#### P2P(Peer-to-peer)

- 각 노드들은 서버와 클라이언트 역할을 동시에 수행   
- 값비싼 장비가 없어도 되지만 서버/클라이언트 모델보다 프로그램 개발이 더 복잡하다.

#### 에이전트/매니저 모델

- 하나의 클라이언트(에이전트)가 다수의 서버(매니저)에게 정보를 요청하는 구성.   
- 즉, 클라이언트/서버는 N : 1이지만 에이전트/매니저는 1 : N 구성을 가진다.   
- 주로 네트워크/시스템 관리 시스템에 이용

#### 서비스 포트
인터넷이란 컴퓨터와 컴퓨터가 연결 되 있는것이 아닌, 프로그램과 프로그램이 연결된 네트워크이다.   
-> 하나의 컴퓨터는 여러 프로그램을 운용할 수 있기때문에 웹서핑, 파일다운로드, 인터넷 음악을 동시에 들을 수 있는 것이다.    
    
하지만, 컴퓨터는 주소를 이용하여 찾지만, 인터넷 프로그램은 어떻게 찾을 수 있을까?
- 인터넷 프로그램은 포트(PORT)를 통해 문제를 해결한다.
- 각 서비스는 고유의 포트 번호를 가지고 있다.
- 클라이언트는 IP로 컴퓨터를 찾아가고, 80번포트로 연결해서 서비스를 요청한다.
- 즉, 인터넷 주소와 포트 번호를 원하는 인터넷 프로그램에 연결해서 서비스를 받는다.
- 포트 번호는 운영체제에서 관리한다.

##### 명시된 포트 번호

수백개의 포트 정보
```
/etc/services
윈도우는 C:\WINDOWS\system32\drivers\etc\services
```
포트 번호 | 프로토콜 이름 | 설명
--- | --- | ---
20,21 | FTP | 파일 전송 프로토콜
22 | SSH | 보안 원격 접속 프로토콜
23 | 텔넷 | 원격 접속 프로토콜
25 | SMTP | 인터넷 메일 프로토콜
37 | TIME | 시간 동기화 프로토콜(컴퓨터 간 시간을 맞추기 위해 사용)
53 | 도메인 | 도메인 이름 서비스 프로토콜
80 | HTTP | 하이퍼 문서 전송 프로토콜
110 | POP3 | 이메일 전송 프로토콜

##### 클라이언트 포트 번호
- 서버는 포트가 고정된다.
- 클라이언트는 1024보다 큰 임의의 번호가 할당된다.


## 네트워크 프로그래밍
- 소켓은 함수의 모음, 즉 라이브러리이다.
- 문제를 세분화하고 각 단계를 분석하고 각 단계별 개발도구를 선택한후 각 단계를 통합해서 하나의 프로그램으로 만든다

1. 소켓을 만든다.(socket 함수 사용)   
2. 클라이언트 : 연결을 시도한다.(connect 함수 사용)    
   서버 : 연결을 기다린다.(accept 함수 사용)    
3. 소켓으로 통신을 한다.(read, write 함수 사용)   
4. 소켓을 닫는다.(close 함수 사용)    

함수 | 내용
--- | ---
socket() | 소켓의 생성 (전화기 설치)
bind() | 소켓 특성을 정의 (전화번호 부여)
listen() | 수신 대기열 생성(연결을 기다린다)
발신자 : connect() | 연결시도 (전화걸기)
수신자 : accept() | 연결 수락(수화기를 든다)
read(), Write() | 데이터 통신(통화)
close() | 연결 종료(통화 종료)

클라이언트 흐름    
socket(생성) -> connect(연결요청) -> read/write(통신) -> close(종료)    

서버 흐름   
socket(생성) -> bind(특성정의) -> listen(대기열) -> accept(수락) -> read/Write(통신) -> close(종료)    

#### 소켓의 생성

```
#include<sys/types.h>
#include<sys/socket.h>

int socket(int domain, int type, int protocol);
```
- socket 함수는 endpoint 소켓(종점 소켓)을 생성한다.
- 클라이언트는 연결 요청을 위한용도 (연결 소켓)
- 서버는 요청을 듣기 위한 용도이다. (듣기 소켓)



